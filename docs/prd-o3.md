### 采购管理 Symfony Bundle 技术方案 PRD (产品需求文档)

#### 一、项目概述

本项目旨在开发一个基于 Symfony 的采购管理 Bundle，提供一整套用于采购订单管理、采购审批流程和采购到货跟踪的解决方案。该 Bundle 将为企业提供集中化的采购管理功能，提升采购效率、审批速度及供应链的可视化管理。

#### 二、功能需求

1. **采购订单管理**

    * 创建、编辑、删除采购订单
    * 管理订单状态（例如：待审批、已审批、已发货、已到货、已完成等）
    * 采购订单的详细信息：商品名称、数量、单价、总价、供应商信息、订单日期等
    * 支持对订单的查询和筛选功能（如按状态、供应商、日期等条件）
    * 提供导出功能（Excel 或 CSV）

2. **采购审批流程**

    * 设定采购订单的审批流程，支持多级审批（如：部门经理审批、财务审批、总经理审批）
    * 审批流程支持自定义配置，可以选择不同的角色参与审批
    * 审批人员可以查看订单详细信息并进行批准或拒绝
    * 支持审批历史记录查询，方便追溯审批进度和操作记录
    * 支持审批超时自动提醒，确保审批及时完成

3. **采购到货跟踪**

    * 实时跟踪采购订单的到货状态
    * 记录到货时间、数量、供应商等信息
    * 提供到货记录的查询和筛选功能
    * 支持设置到货提醒，确保及时处理到货订单
    * 生成到货报告，支持导出

#### 三、技术需求

1. **框架与工具**

    * **Symfony**：作为主要的开发框架，确保系统的可扩展性和高效性。
    * **Doctrine ORM**：用于数据库操作，简化数据存取。
    * **Twig**：用于模板渲染，前端展示。
    * **PHP 8.0+**：系统的最低 PHP 版本要求。
    * **MySQL/PostgreSQL**：作为数据库管理系统。
    * **Webpack**：用于资源管理与打包，前端文件优化。

2. **数据库设计**

    * **采购订单表 (PurchaseOrder)**：

        * id: INT
        * supplier\_id: INT (外键，指向供应商)
        * order\_date: DATETIME
        * total\_amount: DECIMAL
        * status: ENUM (待审批、已审批、已发货、已到货、已完成)
        * created\_at: DATETIME
        * updated\_at: DATETIME

    * **采购审批表 (PurchaseApproval)**：

        * id: INT
        * purchase\_order\_id: INT (外键，指向采购订单)
        * approver\_id: INT (审批人员的用户ID)
        * status: ENUM (待审批、已批准、已拒绝)
        * approval\_date: DATETIME
        * created\_at: DATETIME
        * updated\_at: DATETIME

    * **采购到货表 (PurchaseArrival)**：

        * id: INT
        * purchase\_order\_id: INT (外键，指向采购订单)
        * arrival\_date: DATETIME
        * arrival\_quantity: INT
        * created\_at: DATETIME
        * updated\_at: DATETIME

3. **API 设计**

    * 提供 RESTful API 接口，支持系统与其他外部系统的集成。
    * 主要接口：

        * **POST /orders**：创建采购订单
        * **GET /orders**：查询采购订单
        * **GET /orders/{id}**：查看单个采购订单详情
        * **POST /orders/{id}/approve**：审批采购订单
        * **GET /orders/{id}/arrivals**：查看采购订单的到货信息
        * **POST /orders/{id}/arrive**：记录到货信息

4. **用户权限控制**

    * 支持基于角色的权限管理。
    * 主要角色：

        * 采购员：创建和管理采购订单
        * 部门经理：审批采购订单
        * 财务：审批并确认支付
        * 总经理：审批最终订单
        * 仓库管理员：记录和跟踪到货信息

#### 四、系统架构

* **前端**：

    * 基于 Symfony 和 Twig 构建的视图层。
    * 使用现代 JavaScript 技术栈（如 Vue.js 或 React）增强交互功能。

* **后端**：

    * Symfony 作为后台框架，提供业务逻辑处理、数据存储和管理。
    * 使用 **Doctrine ORM** 进行数据库交互。
    * 使用 **API Platform** 提供 RESTful API 支持。

* **数据库**：

    * 采用 **MySQL** 或 **PostgreSQL** 作为数据库系统，确保高效的数据存储和访问。

* **通知与提醒**：

    * 系统会通过邮件和站内消息提醒用户处理任务（如待审批、到货提醒等）。
    * 支持邮件通知配置（SMTP 设置）。

#### 五、系统部署

1. **环境要求**：

    * **PHP 8.0+**
    * **Symfony 6.0+**
    * **MySQL 5.7+ / PostgreSQL 12+**
    * **Nginx / Apache 作为 Web 服务器**

2. **容器化部署**：

    * 使用 Docker 部署系统，确保开发、测试和生产环境一致。
    * 使用 Docker Compose 管理多容器部署（如数据库、Web 服务、PHP-FPM 等）。

3. **CI/CD 集成**：

    * 使用 GitHub Actions / GitLab CI 管理持续集成和持续部署流程。
    * 自动化测试（PHPUnit）和代码质量检查（PHPStan / PHP CS Fixer）。

#### 六、技术选型与优势

* **Symfony 框架**：成熟的企业级框架，具有丰富的扩展性和社区支持。
* **Doctrine ORM**：简化数据库操作，并支持高度定制化的查询和事务管理。
* **API Platform**：快速构建和管理 RESTful API，支持与其他系统的集成。
* **Docker 容器化**：确保一致的开发、测试和生产环境。

#### 七、项目开发与迭代

1. **第一阶段（需求分析与设计）**：

    * 完成需求收集和功能设计。
    * 制定数据库结构和系统架构设计。

2. **第二阶段（开发与测试）**：

    * 完成主要功能模块开发：采购订单管理、采购审批流程、采购到货跟踪。
    * 单元测试与集成测试。

3. **第三阶段（上线与维护）**：

    * 部署到生产环境。
    * 收集用户反馈，修复 bug 和优化性能。

#### 八、项目风险及应对措施

1. **需求变更风险**：

    * 在项目初期进行详细的需求调研和确认，避免后期频繁变更。

2. **技术难度**：

    * 选用成熟的技术栈，确保团队能快速适应和高效开发。

3. **性能瓶颈**：

    * 优化数据库查询和接口响应时间，使用缓存技术提升系统性能。

---

此文档提供了系统的功能、技术和部署方案，为开发和实施提供了明确的指导方针。在实施过程中，可以根据实际需求进行适当调整。
